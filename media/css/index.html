<!DOCTYPE html >
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>河南同步课堂后台管理中心</title>
<link rel="stylesheet" type="text/css" href="/site_media/css/base.css">
<script src="/site_media/js/jquery-1.8.0.min.js" language="javascript"></script>
<script type="text/javascript" src="/site_media/plugins/artDialog/jquery.artDialog.addSkin.js?skin=default"></script>
<script type='text/javascript' src='/site_media/plugins/artDialog/plugins/iframeTools.js'></script>
</head>
<body id="body">
<div id="head">
		<div class="left logo"><a href="/"><img src="/site_media/images/logo.png" /></a></div>
		<div class="right head_menu">
		  <ul id="head_menu">
              <li>
				  <a href='/help/' target="_blank" title="点击查看帮助"><button class="btn">使用帮助</button></a>&nbsp;&nbsp;&nbsp;&nbsp;
				  <a href="/logout/" title="点击退出平台"><button class="btn">{{user.username}}</button></a>
			  </li>
		  </ul>
		</div>
</div>

 <div id="content">
	 <div id="leftNav" class="left_nav">
          {{menu_html|safe}}
     </div>
	<div id="right">
        <div id="frameTitle" class="right_position"><span index="0" class="on"><em>首页</em></span></div>
        <div id="frameWrap">
            <iframe id="iframe0" scrolling="auto" width="100%" name="main" src="/welcome/" frameborder="0"></iframe>
        </div>
	</div>
</div>

<script type="text/javascript">
    var iframesLength = 1;
    $(function($){
        var frameTitle = $('#frameTitle');
        var frameWrap = $('#frameWrap');
        var timeout = null;
	   //导航栏折叠
        $('#leftNav dt').toggle(function () {
            $(this).nextAll().show();
        },function () {
            $(this).nextAll().hide();
        }).nextAll().hide();
        if ($('#leftNav dt').length === 1) {$('#leftNav dt:eq(0)').trigger('click');};
        //导航选中
        $('#leftNav dd a').click(function () {
            if ($(this).attr('data-target') === 'newtab') {
                window.open($(this).attr('data-href'));
                return false;
            };
            var text = $(this).text();
            var handlerIndex = $(this).attr('index');
            if (typeof handlerIndex != 'undefined') {
                frameTitle.find('span[index='+handlerIndex+']').trigger('click');
                frameTitle.find('var[index='+handlerIndex+']').trigger('click');
            }else{
                var titleTMP = '<span index="' + iframesLength + '"><em>' + text + '</em><var title="刷新" index="' + iframesLength + '">R</var><a href="javascript:;" title="关闭" index="' + iframesLength + '">X</a></span>';
                var frameTMP = '<iframe id="iframe'+iframesLength+'" scrolling="no" width="100%" name="iframe'+iframesLength+'" src="'+$(this).attr('data-href')+'" frameborder="0"></iframe>'
                frameTitle.append(titleTMP);
                frameWrap.append(frameTMP);
                $(this).attr('index',iframesLength);
                frameTitle.find('span[index='+iframesLength+']').trigger('click')
                iframesLength++;
            }
            $('#leftNav dd a').removeClass("on");
            $(this).addClass("on");
        });
        frameTitle.on('click','span',function(e){
            var index = $(this).attr('index');
            $(this).addClass('on').siblings().removeClass('on');
            $('#iframe'+index).show().siblings().hide();
            makeIframeAuto($('#iframe'+index));
            e.stopPropagation();
        })
        frameTitle.on('click','var',function(e){
            var index = $(this).attr('index');
            $('#iframe'+index).attr('src',$('#iframe'+index).attr('src'));
            e.stopPropagation();
        })
        frameTitle.on('click','a',function(e){
            var index = $(this).attr('index');
            frameTitle.find('span[index='+index+']').remove();
            $('#iframe'+index).remove();
            frameTitle.find('span:last').trigger('click');
            $('#leftNav dd a[index='+index+']').removeAttr('index');
            var openwindow = $(this).attr('openwindow');
            if (typeof openwindow != 'undefined') {
                var win = $(window.frames[openwindow].document.body)
                win.find('a[data-target="newtab"][index='+index+']').removeAttr('index');
            };
            e.stopPropagation();
        })
        //设置iframe高度自适应
        function makeIframeAuto(iframe){
            timeout && clearTimeout(timeout);
            timeout = setInterval(function(){
                setHeight(iframe);
            }, 500);
            function setHeight(obj){
                var obj = $(obj);
                var mainheight = obj.contents().find("body").outerHeight()+100;
                if(mainheight < 300)
                    mainheight = 300;
                obj.height(mainheight);
            }
        }
        makeIframeAuto($("#iframe0"));
    })
</script>
</body>
</html>
